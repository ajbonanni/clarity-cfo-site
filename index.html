<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ClarityCFO.ai</title>

  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>

  <!-- Auth0 -->
  <script src="https://cdn.auth0.com/js/auth0-spa-js/1.13/auth0-spa-js.production.js"></script>

  <!-- File parsers -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- NAV -->
  <header class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-blue-600">ClarityCFO.ai</h1>
      <nav class="space-x-6">
        <a href="#how" class="text-gray-700 hover:text-blue-600">How It Works</a>
        <a href="#services" class="text-gray-700 hover:text-blue-600">Services</a>
        <a href="#pricing" class="text-gray-700 hover:text-blue-600">Pricing</a>
        <a href="#demo" class="text-gray-700 hover:text-blue-600">AI Demo</a>
        <a href="#upload" class="text-white bg-blue-600 px-4 py-2 rounded">Get Started</a>
        <span id="authStatus" class="text-sm text-gray-500"></span>
        <button id="loginBtn" class="text-sm text-blue-600 underline ml-4">Login</button>
        <button id="logoutBtn" class="text-sm text-red-600 underline ml-4" style="display:none">Logout</button>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="bg-gradient-to-b from-blue-50 to-white py-20 text-center">
    <h1 class="text-4xl font-bold text-gray-900 mb-4">Modern Finance. Automated. Scalable.</h1>
    <p class="text-lg mb-6">ClarityCFO blends senior CFO strategy with real-time AI tools.</p>
    <a href="#upload" class="bg-blue-600 text-white px-6 py-3 rounded shadow">Get Your 5-Minute CFO Assessment ‚Üí</a>
  </section>

  <!-- AI Demo -->
  <section id="demo" class="py-16 text-center">
    <h2 class="text-xl font-bold mb-4">AI Demo: Import & Analyze</h2>
    <p class="mb-4">We support .csv, .xlsx, and .pdf files.</p>
    <input type="file" id="fileInput" class="border p-2 rounded mb-4" accept=".csv,.xlsx,.pdf"/>
    <button onclick="handleUpload()" class="bg-blue-600 text-white px-6 py-2 rounded">Upload File</button>
  </section>

  <!-- File Upload -->
  <section id="upload" class="py-12 text-center">
    <h2 class="text-xl font-bold mb-4">Upload Your Financials</h2>
    <input type="file" id="fileInput2" class="border p-2 rounded mb-4" accept=".csv,.xlsx,.pdf"/>
    <button onclick="handleUpload()" class="bg-blue-600 text-white px-6 py-2 rounded">Submit</button>
    <p id="uploadStatus" class="text-green-600 mt-4 hidden"></p>
    <div id="diagnosticResults" class="mt-6 p-4 bg-yellow-50 border border-yellow-300 rounded text-yellow-900 hidden"></div>
  </section>

  <!-- Firebase Init + App Logic -->
  <script>
    // Auth0
    let auth0Client = null;
    async function configureClient() {
      auth0Client = await createAuth0Client({
        domain: "dev-pnuopchazfb3feef.us.auth0.com",
        client_id: "80EnQZGLRCTNKvmSSyuWXx9Anvid9Paq",
        cacheLocation: "localstorage",
        useRefreshTokens: true
      });
    }
    async function login() { await auth0Client.loginWithRedirect({ redirect_uri: window.location.origin }); }
    function logout() { auth0Client.logout({ returnTo: window.location.origin }); }

    window.onload = async () => {
      document.getElementById("loginBtn").onclick = login;
      document.getElementById("logoutBtn").onclick = logout;
      await configureClient();
      const isAuth = await auth0Client.isAuthenticated();
      if (isAuth) {
        const user = await auth0Client.getUser();
        document.getElementById("authStatus").innerHTML = `üîê Logged in as: <strong>${user.email}</strong>`;
        document.getElementById("loginBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "inline-block";
      } else {
        document.getElementById("authStatus").innerHTML = `üö´ Not logged in`;
      }
    };

    // Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCfYTgv1MVWfDezRV-i00oL9ca3f56auFc",
      authDomain: "clarity-cfo.firebaseapp.com",
      projectId: "clarity-cfo",
      storageBucket: "clarity-cfo.firebasestorage.app",
      messagingSenderId: "744282604632",
      appId: "1:744282604632:web:33f064b034e82a9c40f62d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Upload + Diagnostics
    function handleUpload() {
      const fileInput = document.getElementById("fileInput") || document.getElementById("fileInput2");
      const file = fileInput.files[0];
      const uploadStatus = document.getElementById("uploadStatus");
      const diag = document.getElementById("diagnosticResults");
      if (!file) return alert("Please select a file.");

      uploadStatus.textContent = "‚è≥ Reading file‚Ä¶";
      uploadStatus.classList.remove("hidden");

      const ext = file.name.split('.').pop().toLowerCase();
      if (ext === "csv") {
        Papa.parse(file, {
          header: true, skipEmptyLines: true,
          complete: (results) => processRows(results.data, file.name, uploadStatus, diag)
        });
      } else if (ext === "xlsx") {
        const reader = new FileReader();
        reader.onload = e => {
          const wb = XLSX.read(e.target.result, { type: "array" });
          const sheet = wb.Sheets[wb.SheetNames[0]];
          const rows = XLSX.utils.sheet_to_json(sheet, { defval: "" });
          processRows(rows, file.name, uploadStatus, diag);
        };
        reader.readAsArrayBuffer(file);
      } else if (ext === "pdf") {
        storage.ref().child("uploads/" + file.name).put(file)
          .then(() => uploadStatus.textContent = "üìÑ PDF uploaded to Firebase Storage.")
          .catch(() => uploadStatus.textContent = "‚ùå PDF upload failed.");
      } else {
        uploadStatus.textContent = "‚ùå Unsupported file type.";
      }
    }

    function processRows(rows, filename, uploadStatus, diag) {
      let revenue = 0, expenses = 0;
      rows.forEach(row => {
        const name = (row["Account"] || "").toLowerCase();
        const amt = parseFloat(row["Amount"] || 0);
        if (name.includes("revenue")) revenue += amt;
        if (name.includes("expense")) expenses += amt;
      });
      const burn = expenses - revenue;
      const fmt = n => n.toLocaleString("en-US", { style: "currency", currency: "USD" });
      uploadStatus.textContent = `üìä Revenue: ${fmt(revenue)} | Expenses: ${fmt(expenses)} | Burn: ${fmt(burn)}`;

      const flags = [];
      if (burn > 50000) flags.push("‚ö†Ô∏è High burn rate");
      if (revenue === 0) flags.push("‚ö†Ô∏è No revenue");
      if (expenses > 2 * revenue) flags.push("‚ö†Ô∏è Expenses exceed 2√ó revenue");
      if (revenue < 50000) flags.push("‚ö†Ô∏è Revenue < $50k");

      diag.innerHTML = flags.length
        ? `<h4 class="font-bold mb-2">AI Diagnostic Summary:</h4><ul class="list-disc">${flags.map(f => `<li>${f}</li>`).join("")}</ul>`
        : `<p class="text-green-700">‚úÖ No Tier 1 issues detected.</p>`;
      diag.classList.remove("hidden");

      db.collection("financial_uploads").add({ filename, revenue, expenses, burn, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
    }
  </script>

  <!-- ‚úÖ Updated Script Paths -->
  <script src="js/firebase-config.js"></script>
  <script src="js/chart.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
</html>
<!-- Force Vercel redeploy -->
